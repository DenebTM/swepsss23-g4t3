# PlantHealth Frontend

Frontend for software engineering project, summer semester 2023.

## Setup

Ensure you have [Node v18](https://nodejs.org/en/download/) installed, then run the following in a terminal:

```
cd frontend          -- Navigate to the frontend directory
yarn                 -- Install node_modules: may take a few minutes
yarn setup-husky     -- Set up Husky linting hook
```

If you get an error from [lint-staged](https://github.com/okonet/lint-staged) stating that the local version of eslint can not be found, then it might be necessary to run `npm install -g eslint`.

To build the app, run `mvn spring-boot:run` in a terminal.

For production testing, navigate to [localhost:8080/](http://localhost:8080/).

For development testing, run `yarn start` in a new terminal (to reload the frontend on save) and navigate to [localhost:3000/](http://localhost:3000/).

## Available Scripts

When the backend is stared with `mvn spring-boot:run` then the frontend is available at [localhost:8080](http://localhost:8080). Several scripts are defined in the [`package.json`](package.json) to aid development, which are detailed below.

- ##### `yarn start`

  Run the app at [localhost:3000](http://localhost:3000) with hot reloading (for development). Start the backend with `mvn spring-boot:run`, then run `yarn start` in another terminal.

- ##### `yarn mock`

  Start the frontend at [localhost:3000](http://localhost:3000) with hot reload a mocked backend. In this case, the frontend is self-contained: there is no need to run `mvn spring-boot:run` first.

- ##### `yarn check-types`

  Check TypeScript types with `tsc`.

- ##### `yarn test`

  Run usit tests and check code for typing and linter errors.

- ##### `yarn coverage`

  Runs `vitest` and prints a test coverage report for the frontend generated by c8. See also [the vitest coverage guides](https://vitest.dev/guide/coverage.html).

- ##### `yarn mvn-test`

  The test job that is run during Maven build.

- ##### `yarn build`
  Builds the app for production to the `dist` folder using `vite build`.

## Stack

This project uses [React 18](https://react.dev/) with components from [Material UI](https://mui.com/material-ui/getting-started/overview/). The project is built with [Vite](https://vitejs.dev/) and dependencies are managed with [Yarn](https://yarnpkg.com/). A mocked backend is implemented for development and testing using [Mirage](https://miragejs.com/).

### Automated Linting

[ESLint](https://eslint.org/docs/latest/) and [Prettier](https://prettier.io/docs/en/index.html) are used to enforce coding style. Before each commit, [Husky](https://typicode.github.io/husky/#/) automatically staged filed using [lint-staged](https://github.com/okonet/lint-staged).

### Testing

Tests are implemented using [Jest](https://jestjs.io/docs/tutorial-react) with [Vitest](https://vitest.dev/) and can be fround in [`src/tests`](src/tests). Tests can be run with `yarn test`.

## Troubleshooting

- If `yarn build` or `yarn start` shows errors like `Can't resolve ...`, try running `yarn cache clean` from within the `frontend` directory and deleting the `node_modules` folder. On the next run, all frontend dependencies will be reacquired and the build should succeed.

- If using VSCode to format files and Prettier uses the wrong format, you might need to [tell VS Code where the .prettierrc config file is](https://marketplace.visualstudio.com/items?itemName=esbenp.prettier-vscode#configuring-default-options). This happens because VS Code searches for [`.prettierrc`](config/.prettierrc) in the root directory by default.

- If running `yarn` causes an error like `"EPERM: operation not permitted, unlink ...` then stop `yarn start` and `mvn spring-boot:run` processes in other terminals. If the error persists on Windows, then open the task manager and manually close all Node.js processes.

- If a dependendency is shown as not being found in VSCode despite being installed, then run `Help > Show All Commands > Restart TS Server`.
